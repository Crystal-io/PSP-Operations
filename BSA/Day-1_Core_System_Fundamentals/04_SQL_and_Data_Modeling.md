# 04. SQL и моделирование данных (усиленная версия)

## Цель модуля
Дать системное и практическое понимание работы с данными для System / Business Analyst:
- как устроены базы данных
- чем отличаются типы БД
- как выбирать подходящее хранилище
- как объяснять это на интервью

Фокус — **архитектурное и аналитическое мышление**, а не администрирование БД.

---

## 1. Роль данных и БД в продукте

База данных — это:
- источник истины для системы
- основа бизнес-логики
- ключевой фактор производительности и масштабируемости

Аналитик должен понимать:
- как данные хранятся
- как они связаны
- какие ограничения накладывает выбранный тип БД

---

## 2. Реляционные vs Нереляционные БД

### Реляционные БД (SQL)

Примеры:
- PostgreSQL
- MySQL
- Oracle
- MS SQL Server

**Характеристики:**
- строгая схема
- таблицы и связи
- ACID-транзакции
- SQL как язык запросов

**Когда использовать:**
- финансовые операции
- транзакционные системы
- строгая консистентность данных

---

### Нереляционные БД (NoSQL)

Примеры:
- MongoDB (Document)
- Redis (Key-Value)
- Cassandra (Wide-column)
- DynamoDB

**Характеристики:**
- гибкая схема
- высокая масштабируемость
- eventual consistency (часто)
- оптимизация под конкретные кейсы

**Когда использовать:**
- high-load системы
- большие объёмы данных
- кэширование и real-time сценарии

---

## 3. Сравнение SQL vs NoSQL (для интервью)

| Критерий | SQL | NoSQL |
|-------|-----|-------|
| Схема | Жёсткая | Гибкая |
| Транзакции | ACID | Ограниченно |
| Масштабирование | Вертикальное | Горизонтальное |
| Consistency | Strong | Eventual |
| Типовые кейсы | Payments, ERP | Logs, events, cache |

---

## 4. Современные аналитические БД (ClickHouse и аналоги)

### ClickHouse

ClickHouse — это **колоночная аналитическая БД**, ориентированная на:
- быстрые агрегации
- большие объёмы данных
- read-heavy нагрузки

**Особенности:**
- column-oriented storage
- высокая скорость SELECT
- слабая поддержка UPDATE/DELETE
- не предназначена для OLTP

**Типовые кейсы:**
- аналитика событий
- метрики
- отчёты
- BI

---

### OLTP vs OLAP

**OLTP:**
- много записей
- короткие транзакции
- PostgreSQL, MySQL

**OLAP:**
- мало записей
- сложные агрегации
- ClickHouse, BigQuery, Redshift

---

## 5. Ключи в БД

### Первичный ключ (Primary Key)

- уникально идентифицирует запись
- не может быть NULL
- гарантирует целостность

Пример:
```sql
id BIGINT PRIMARY KEY
```

---

### Составной ключ (Composite Key)

- состоит из нескольких полей
- используется, когда уникальность достигается комбинацией

Пример:
```sql
PRIMARY KEY (user_id, date)
```

**Риски:**
- сложные JOIN
- тяжёлые индексы

---

## 6. Внешние ключи (Foreign Key)

- обеспечивают ссылочную целостность
- предотвращают «висячие» записи

Аналитик должен понимать:
- влияние FK на производительность
- где их уместно использовать, а где нет

---

## 7. Индексация: зачем и как

Индекс — это структура данных, ускоряющая поиск.

**Цена индекса:**
- дополнительное место
- замедление INSERT/UPDATE

---

### Основные типы индексов

**B-tree**
- самый распространённый
- подходит для диапазонов

**Hash**
- быстрый поиск по равенству
- редко используется напрямую

**GIN**
- массивы, JSON, full-text

**GiST**
- геоданные, сложные типы

---

## 8. Когда индексы вредны

- частые записи
- маленькие таблицы
- избыточное индексирование

Аналитик должен уметь:
- задавать вопросы про нагрузку
- понимать trade-offs

---

## 9. Типовые вопросы на интервью (с ответами)

**Вопрос:** Чем реляционная БД отличается от NoSQL?  
**Ответ:** Реляционная БД обеспечивает строгую схему и транзакционность, NoSQL — масштабируемость и гибкость.

**Вопрос:** Когда использовать ClickHouse?  
**Ответ:** Для аналитики и отчётов с большими объёмами данных и сложными агрегациями.

**Вопрос:** Что такое составной ключ и когда он нужен?  
**Ответ:** Это ключ из нескольких полей, используется для обеспечения уникальности по комбинации значений.

**Вопрос:** Зачем нужны индексы?  
**Ответ:** Для ускорения чтения данных за счёт дополнительных структур.

**Вопрос:** Почему нельзя индексировать всё подряд?  
**Ответ:** Индексы замедляют запись и увеличивают размер БД.

---

## Результат модуля

После этого модуля ты:
- понимаешь типы БД и их назначение
- можешь обсуждать ClickHouse и OLAP
- уверенно говоришь про ключи и индексы
- выглядишь как зрелый System Analyst

Следующий модуль:
05_API_Design_and_Integration.md
